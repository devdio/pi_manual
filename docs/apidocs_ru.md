# Справочник API KamibotPi

## Содержание
1. [Обзор класса](#обзор-класса)
2. [Конструктор](#конструктор)
3. [Управление соединением](#управление-соединением)
4. [Базовое управление движением](#базовое-управление-движением)
5. [Управление скоростью](#управление-скоростью)
6. [Точное управление](#точное-управление)
7. [Управление светодиодами](#управление-светодиодами)
8. [Управление верхним мотором](#управление-верхним-мотором)
9. [Управление датчиками](#управление-датчиками)
10. [Рисование фигур](#рисование-фигур)
11. [Воспроизведение мелодий](#воспроизведение-мелодий)
12. [Утилиты](#утилиты)
13. [Константы и перечисления](#константы-и-перечисления)

---

## Обзор класса

### `class KamibotPi`
Основной класс для управления роботом KamibotPi. Обеспечивает связь с роботом через последовательное соединение и предоставляет различные функции управления.

---

## Конструктор

### `__init__(port=None, baud=57600, timeout=2, verbose=False)`
Инициализирует объект KamibotPi и устанавливает последовательное соединение.

**Параметры:**
- `port` (str): Имя последовательного порта (обязательно)
- `baud` (int): Скорость передачи данных (по умолчанию: 57600)
- `timeout` (int): Таймаут чтения (секунды) (по умолчанию: 2)
- `verbose` (bool): Включить отладочный вывод (по умолчанию: False)

**Исключения:**
- `ValueError`: Если порт не указан
- `serial.SerialException`: При ошибке подключения к последовательному порту

**Пример:**
```python
kb = KamibotPi(port="COM5", baud=57600, timeout=2, verbose=True)
```

---

## Управление соединением

### `init()`
Инициализирует робота.

**Возвращает:** `None`

**Пример:**
```python
kb.init()
```

### `close()`
Закрывает последовательное соединение и завершает программу.

**Возвращает:** `None` (фактически вызывает `sys.exit(0)`)

**Пример:**
```python
kb.close()
```

### `disconnect()`
Закрывает последовательное соединение (без завершения программы).

**Возвращает:** `None`

**Пример:**
```python
kb.disconnect()
```

---

## Базовое управление движением

### `move_forward(value, opt="-l")`
Перемещает робота вперед на указанное количество клеток.

**Параметры:**
- `value` (int): Количество клеток для перемещения
- `opt` (str): Тип игрового поля ("-l": линейное поле, "-b": блочное поле)

**Возвращает:** `None`

**Пример:**
```python
kb.move_forward(2, opt="-l")  # Движение на 2 клетки вперед на линейном поле
kb.move_forward(1, opt="-b")  # Движение на 1 клетку вперед на блочном поле
```

### `move_backward(value)`
Перемещает робота назад на указанное количество клеток (только для блочного поля).

**Параметры:**
- `value` (int): Количество клеток для перемещения

**Возвращает:** `None`

**Пример:**
```python
kb.move_backward(1)
```

### `turn_left(value=1, opt='-l')`
Поворачивает робота влево.

**Параметры:**
- `value` (int): Количество поворотов (действует только на блочном поле)
- `opt` (str): Тип игрового поля ("-l": линейное поле, "-b": блочное поле)

**Возвращает:** `None`

**Пример:**
```python
kb.turn_left(value=2, opt="-b")  # 2 поворота влево на блочном поле
kb.turn_left(opt="-l")           # Поворот влево на линейном поле
```

### `turn_right(value=1, opt='-l')`
Поворачивает робота вправо.

**Параметры:**
- `value` (int): Количество поворотов (действует только на блочном поле)
- `opt` (str): Тип игрового поля ("-l": линейное поле, "-b": блочное поле)

**Возвращает:** `None`

**Пример:**
```python
kb.turn_right(value=1, opt="-l")
```

### `turn_back(value=1, opt='-l')`
Поворачивает робота на 180 градусов.

**Параметры:**
- `value` (int): Количество поворотов (действует только на блочном поле)
- `opt` (str): Тип игрового поля ("-l": линейное поле, "-b": блочное поле)

**Возвращает:** `None`

**Пример:**
```python
kb.turn_back(opt="-l")
```

### `stop()`
Останавливает движение робота.

**Возвращает:** `None`

**Пример:**
```python
kb.stop()
```

---

## Управление скоростью

### `go_dir_speed(ldir, lspeed, rdir, rspeed)`
Индивидуально управляет направлением и скоростью левого и правого колес.

**Параметры:**
- `ldir` (str): Направление левого колеса ("f": вперед, "b": назад)
- `lspeed` (int): Скорость левого колеса
- `rdir` (str): Направление правого колеса ("f": вперед, "b": назад)
- `rspeed` (int): Скорость правого колеса

**Возвращает:** `None`

**Пример:**
```python
kb.go_dir_speed("f", 120, "b", 110)  # Левое колесо вперед, правое назад
```

### `go_forward_speed(lspeed, rspeed)`
Движение вперед с указанными скоростями.

**Параметры:**
- `lspeed` (int): Скорость левого колеса
- `rspeed` (int): Скорость правого колеса

**Возвращает:** `None`

**Пример:**
```python
kb.go_forward_speed(120, 120)
```

### `go_backward_speed(lspeed, rspeed)`
Движение назад с указанными скоростями.

**Параметры:**
- `lspeed` (int): Скорость левого колеса
- `rspeed` (int): Скорость правого колеса

**Возвращает:** `None`

**Пример:**
```python
kb.go_backward_speed(100, 100)
```

### `go_left_speed(speed)`
Поворот влево с указанной скоростью.

**Параметры:**
- `speed` (int): Скорость поворота

**Возвращает:** `None`

**Пример:**
```python
kb.go_left_speed(90)
```

### `go_right_speed(speed)`
Поворот вправо с указанной скоростью.

**Параметры:**
- `speed` (int): Скорость поворота

**Возвращает:** `None`

**Пример:**
```python
kb.go_right_speed(90)
```

---

## Точное управление

### `move_step(ldir, lstep, rdir, rstep)`
Выполняет точное движение в единицах шагов.

**Параметры:**
- `ldir` (str): Направление левого колеса ("f": вперед, "b": назад)
- `lstep` (int): Количество шагов левого колеса
- `rdir` (str): Направление правого колеса ("f": вперед, "b": назад)
- `rstep` (int): Количество шагов правого колеса

**Возвращает:** `None`

**Пример:**
```python
kb.move_step("f", 400, "b", 400)
```

### `move_time(ldir, lsec, rdir, rsec)`
Выполняет точное движение на основе времени.

**Параметры:**
- `ldir` (str): Направление левого колеса ("f": вперед, "b": назад)
- `lsec` (int): Время движения левого колеса (секунды)
- `rdir` (str): Направление правого колеса ("f": вперед, "b": назад)
- `rsec` (int): Время движения правого колеса (секунды)

**Возвращает:** `None`

**Пример:**
```python
kb.move_time("f", 2, "f", 2)
```

### `move_forward_unit(value=10, opt="-l", speed=50)`
Движение вперед на основе единиц измерения.

**Параметры:**
- `value` (int): Значение перемещения
- `opt` (str): Тип единицы ("-l": см, "-t": секунды, "-s": шаги)
- `speed` (int): Скорость движения

**Возвращает:** `None`

**Пример:**
```python
kb.move_forward_unit(20, opt="-l", speed=80)  # 20 см вперед
kb.move_forward_unit(2, opt="-t", speed=60)   # 2 секунды вперед
kb.move_forward_unit(500, opt="-s", speed=50) # 500 шагов вперед
```

### `move_backward_unit(value=10, opt="-l", speed=50)`
Движение назад на основе единиц измерения.

**Параметры:**
- `value` (int): Значение перемещения
- `opt` (str): Тип единицы ("-l": см, "-t": секунды, "-s": шаги)
- `speed` (int): Скорость движения

**Возвращает:** `None`

**Пример:**
```python
kb.move_backward_unit(10, opt="-l", speed=50)
```

### `move_left_unit(value=10, opt="-l", speed=50)`
Движение влево на основе единиц измерения.

**Параметры:**
- `value` (int): Значение перемещения
- `opt` (str): Тип единицы ("-l": см, "-t": секунды, "-s": шаги)
- `speed` (int): Скорость движения

**Возвращает:** `None`

**Пример:**
```python
kb.move_left_unit(15, opt="-l", speed=70)
```

### `move_right_unit(value=10, opt="-l", speed=50)`
Движение вправо на основе единиц измерения.

**Параметры:**
- `value` (int): Значение перемещения
- `opt` (str): Тип единицы ("-l": см, "-t": секунды, "-s": шаги)
- `speed` (int): Скорость движения

**Возвращает:** `None`

**Пример:**
```python
kb.move_right_unit(10, opt="-l", speed=60)
```

### `turn_left_speed(value=90, speed=50)`
Поворот влево на месте на указанный угол.

**Параметры:**
- `value` (int): Угол поворота
- `speed` (int): Скорость поворота

**Возвращает:** `None`

**Пример:**
```python
kb.turn_left_speed(45, speed=60)
```

### `turn_right_speed(value=90, speed=50)`
Поворот вправо на месте на указанный угол.

**Параметры:**
- `value` (int): Угол поворота
- `speed` (int): Скорость поворота

**Возвращает:** `None`

**Пример:**
```python
kb.turn_right_speed(90, speed=50)
```

### `turn_continous(dir="l", speed=100)`
Непрерывное вращение в указанном направлении.

**Параметры:**
- `dir` (str): Направление вращения ("l": влево, "r": вправо)
- `speed` (int): Скорость вращения

**Возвращает:** `None`

**Пример:**
```python
kb.turn_continous("r", speed=80)
kb.stop()  # Остановка вращения
```

---

## Управление светодиодами

### `turn_led(rval, gval, bval)`
Устанавливает цвет светодиода с помощью значений RGB.

**Параметры:**
- `rval` (int): Значение красного (0-255)
- `gval` (int): Значение зеленого (0-255)
- `bval` (int): Значение синего (0-255)

**Возвращает:** `None`

**Пример:**
```python
kb.turn_led(255, 0, 0)    # Красный
kb.turn_led(0, 255, 0)    # Зеленый
kb.turn_led(255, 255, 0)  # Желтый
```

### `turn_led_idx(idx)`
Устанавливает цвет светодиода с помощью предустановленного индекса.

**Параметры:**
- `idx` (int): Индекс цвета (0-8)
  - 0: off (выключен)
  - 1: red (красный)
  - 2: orange (оранжевый)
  - 3: yellow (желтый)
  - 4: green (зеленый)
  - 5: blue (синий)
  - 6: skyblue (голубой)
  - 7: purple (фиолетовый)
  - 8: white (белый)

**Возвращает:** `None`

**Пример:**
```python
kb.turn_led_idx(1)  # Красный
kb.turn_led_idx(4)  # Зеленый
```

---

## Управление верхним мотором

### `top_motor_degree(dir, value=90, speed=50)`
Поворачивает верхний мотор на указанный угол.

**Параметры:**
- `dir` (str): Направление поворота ("l": влево, "r": вправо)
- `value` (int): Угол поворота
- `speed` (int): Скорость поворота

**Возвращает:** `None`

**Пример:**
```python
kb.top_motor_degree("l", value=45, speed=60)
kb.top_motor_degree("r", value=90, speed=80)
```

### `top_motor_abspos(degree=0, speed=50)`
Перемещает верхний мотор в абсолютную позицию.

**Параметры:**
- `degree` (int): Целевой абсолютный угол (максимум 65000)
- `speed` (int): Скорость поворота

**Возвращает:** `None`

**Пример:**
```python
kb.top_motor_abspos(180, speed=70)  # В позицию 180 градусов
kb.top_motor_abspos(0, speed=50)    # Возврат к исходной позиции
```

### `top_motor_time(dir, value=3, speed=50)`
Поворачивает верхний мотор в течение указанного времени.

**Параметры:**
- `dir` (str): Направление поворота ("l": влево, "r": вправо)
- `value` (int): Время поворота (секунды)
- `speed` (int): Скорость поворота

**Возвращает:** `None`

**Пример:**
```python
kb.top_motor_time("r", value=2, speed=80)
```

### `top_motor_round(dir, value=1, speed=50)`
Поворачивает верхний мотор на указанное количество оборотов.

**Параметры:**
- `dir` (str): Направление поворота ("l": влево, "r": вправо)
- `value` (int): Количество оборотов
- `speed` (int): Скорость поворота

**Возвращает:** `None`

**Пример:**
```python
kb.top_motor_round("l", value=3, speed=40)
```

### `top_motor_stop()`
Останавливает поворот верхнего мотора.

**Возвращает:** `None`

**Пример:**
```python
kb.top_motor_stop()
```

---

## Управление датчиками

### `get_object_detect(opt=True)`
Активирует датчик обнаружения объектов и считывает значения.

**Параметры:**
- `opt` (bool): Состояние датчика (True: активен, False: остановлен)

**Возвращает:** `tuple(int, int)` - (левое значение обнаружения, правое значение обнаружения)

**Пример:**
```python
left_obj, right_obj = kb.get_object_detect(True)
print(f"Левый: {left_obj}, Правый: {right_obj}")
```

### `get_line_sensor(opt=True)`
Активирует датчик обнаружения линии и считывает значения.

**Параметры:**
- `opt` (bool): Состояние датчика (True: активен, False: остановлен)

**Возвращает:** `tuple(int, int, int)` - (левое, центральное, правое значения обнаружения линии)

**Примечание:** В возвращаемых значениях левое и правое поменяны местами (коррекция аппаратного обеспечения)

**Пример:**
```python
left, center, right = kb.get_line_sensor(True)
print(f"Датчик линии - Левый: {left}, Центр: {center}, Правый: {right}")
```

### `get_color_sensor(opt=True)`
Активирует датчик цвета и считывает индекс цвета.

**Параметры:**
- `opt` (bool): Состояние датчика (True: активен, False: остановлен)

**Возвращает:** `int` - Индекс цвета

**Пример:**
```python
color = kb.get_color_sensor(True)
print(f"Обнаруженный цвет: {color}")
```

### `get_color_elements(opt=True)`
Активирует датчик цвета и считывает значения RGB.

**Параметры:**
- `opt` (bool): Состояние датчика (True: активен, False: остановлен)

**Возвращает:** `tuple(int, int, int)` - Значения (R, G, B)

**Пример:**
```python
r, g, b = kb.get_color_elements(True)
print(f"RGB: ({r}, {g}, {b})")
```

### `get_battery()`
Считывает уровень заряда батареи.

**Возвращает:** `int` - Уровень заряда батареи

**Пример:**
```python
battery = kb.get_battery()
print(f"Батарея: {battery}")
```

### `get_version()`
Запрашивает информацию о версии прошивки.

**Возвращает:** `None`

**Пример:**
```python
kb.get_version()
```

### `toggle_linetracer(mode, speed=100)`
Включает или выключает функцию следования по линии.

**Параметры:**
- `mode` (bool): Состояние функции (True: включить, False: выключить)
- `speed` (int): Скорость следования по линии

**Возвращает:** `None`

**Пример:**
```python
kb.toggle_linetracer(True, speed=120)   # Включить следование по линии
kb.toggle_linetracer(False)             # Выключить следование по линии
```

---

## Рисование фигур

### `draw_tri(len)`
Рисует треугольник.

**Параметры:**
- `len` (int): Длина стороны треугольника (см)

**Возвращает:** `None`

**Пример:**
```python
kb.draw_tri(10)
```

### `draw_rect(len)`
Рисует прямоугольник.

**Параметры:**
- `len` (int): Длина стороны прямоугольника (см)

**Возвращает:** `None`

**Пример:**
```python
kb.draw_rect(12)
```

### `draw_penta(len)`
Рисует пятиугольник.

**Параметры:**
- `len` (int): Длина стороны пятиугольника (см)

**Возвращает:** `None`

**Пример:**
```python
kb.draw_penta(8)
```

### `draw_hexa(len)`
Рисует шестиугольник.

**Параметры:**
- `len` (int): Длина стороны шестиугольника (см)

**Возвращает:** `None`

**Пример:**
```python
kb.draw_hexa(7)
```

### `draw_star(len)`
Рисует звезду.

**Параметры:**
- `len` (int): Длина стороны звезды (см)

**Возвращает:** `None`

**Пример:**
```python
kb.draw_star(10)
```

### `draw_circle(len)`
Рисует круг.

**Параметры:**
- `len` (int): Радиус круга (см)

**Возвращает:** `None`

**Пример:**
```python
kb.draw_circle(6)
```

### `draw_semicircle(len, side="l")`
Рисует полукруг.

**Параметры:**
- `len` (int): Радиус круга (см)
- `side` (str): Направление полукруга ("l": левый, "r": правый)

**Возвращает:** `None`

**Пример:**
```python
kb.draw_semicircle(5, side="l")
kb.draw_semicircle(5, side="r")
```

### `draw_arc(radius, value=1, mode=0)`
Рисует дугу.

**Параметры:**
- `radius` (int): Радиус круга (см)
- `value` (int): Значение в зависимости от режима (время или угол)
- `mode` (int): Режим (0: на основе времени, 1: на основе угла)

**Возвращает:** `None`

**Пример:**
```python
kb.draw_arc(8, value=2, mode=0)   # Дуга в течение 2 секунд
kb.draw_arc(8, value=90, mode=1)  # Дуга на 90 градусов
```

---

## Воспроизведение мелодий

### `melody(scale=45, sec=1)`
Воспроизводит звук с указанной нотой и продолжительностью.

**Параметры:**
- `scale` (int): Нота (0-83)
- `sec` (int): Время воспроизведения (секунды)

**Возвращает:** `None`

**Пример:**
```python
kb.melody(scale=60, sec=1)
kb.melody(scale=45, sec=2)
```

### `beep()`
Воспроизводит короткий звуковой сигнал.

**Возвращает:** `None`

**Пример:**
```python
kb.beep()
```

---

## Утилиты

### `delay(sec)`
Ожидает указанное время.

**Параметры:**
- `sec` (float): Время ожидания (секунды)

**Возвращает:** `None`

**Пример:**
```python
kb.delay(0.5)
```

### `delayms(ms)`
Ожидает указанное время (в миллисекундах).

**Параметры:**
- `ms` (int): Время ожидания (миллисекунды)

**Возвращает:** `None`

**Пример:**
```python
kb.delayms(500)  # Ожидание 500 мс
```

### `wait(ms)`
Псевдоним для `delayms()`.

**Параметры:**
- `ms` (int): Время ожидания (миллисекунды)

**Возвращает:** `None`

**Пример:**
```python
kb.wait(1000)  # Ожидание 1 секунды
```

### `angle3p(p1, p2, p3)` (статический метод)
Вычисляет угол между тремя точками.

**Параметры:**
- `p1` (tuple): Первая точка (x1, y1)
- `p2` (tuple): Вторая точка (x2, y2)
- `p3` (tuple): Третья точка (x3, y3)

**Возвращает:** `float` - Угол против часовой стрелки (градусы)

**Пример:**
```python
angle = KamibotPi.angle3p((0, 0), (1, 0), (1, 1))
```

### `remap(value, source_range, target_range)`
Преобразует значение из одного диапазона в другой.

**Параметры:**
- `value` (float): Значение для преобразования
- `source_range` (tuple): Исходный диапазон (min, max)
- `target_range` (tuple): Целевой диапазон (min, max)

**Возвращает:** `float` - Преобразованное значение

**Пример:**
```python
mapped = kb.remap(50, (0, 100), (0, 10))  # Результат: 5.0
```

---

## Константы и перечисления

### `class CommandType`
Определяет константы типов команд прошивки.

**Основные константы:**
- `FORCE_STOP = 0x01`
- `MOVE_FORWARD_BLOCK = 0x02`
- `MOVE_BACKWARD_BLOCK = 0x03`
- `TURN_LEFT_BLOCK = 0x04`
- `TURN_RIGHT_BLOCK = 0x05`
- и многие другие типы команд...

### `class ModeType`
Определяет константы типов режимов работы.

**Основные константы:**
- `MAPBOARD = 0x01`
- `CONTROL = 0x02`
- `RGB = 0x03`
- `TOP_STEPPER = 0x04`
- `OBJECT_DETECTER = 0x05`
- `LINE_DETECTOR = 0x06`
- `COLOR_DETECTOR = 0x07`
- и многие другие типы режимов...

### `class PacketIndex`
Определяет смещения байтов в передаваемом пакете.

**Основные константы:**
- `START = 0`
- `LENGTH = 1`
- `HWID = 2`
- `HWTYPE = 3`
- `COMMANDTYPE = 4`
- и другие поля пакета...

### `class RETURN_PACKET`
Определяет смещения байтов в принимаемом пакете.

**Основные константы:**
- `START = 0`
- `LENGTH = 1`
- `BATTERY = 7`
- `LEFT_OBJECT = 8`
- `RIGHT_OBJECT = 9`
- и другие поля пакета возврата...

### `LED` (словарь)
Содержит предопределенные цвета светодиодов.

**Цвета:**
- `"off"`: [0, 0, 0] - выключен
- `"red"`: [255, 0, 0] - красный
- `"orange"`: [255, 165, 0] - оранжевый
- `"yellow"`: [255, 255, 0] - желтый
- `"green"`: [0, 255, 0] - зеленый
- `"blue"`: [0, 0, 255] - синий
- `"skyblue"`: [0, 255, 255] - голубой
- `"purple"`: [139, 0, 255] - фиолетовый
- `"white"`: [255, 255, 255] - белый

**Пример:**
```python
kb.turn_led(*LED["red"])     # Установить красный цвет
kb.turn_led(*LED["green"])   # Установить зеленый цвет
```

### `LED_COLOR` (список)
Массив цветов светодиодов, доступ к которым осуществляется по индексу.

**Индексы:**
- `0`: off (выключен)
- `1`: red (красный)
- `2`: orange (оранжевый)
- `3`: yellow (желтый)
- `4`: green (зеленый)
- `5`: blue (синий)
- `6`: skyblue (голубой)
- `7`: purple (фиолетовый)
- `8`: white (белый)

**Пример:**
```python
kb.turn_led(*LED_COLOR[1])  # Красный
kb.turn_led(*LED_COLOR[4])  # Зеленый
```

### `class LedColor`
Класс, определяющий константы цветов светодиодов.

**Константы:**
- `OFF = [0, 0, 0]`
- `RED = [255, 0, 0]`
- `ORANGE = [255, 165, 0]`
- `YELLOW = [255, 255, 0]`
- `GREEN = [0, 255, 0]`
- `BLUE = [0, 0, 255]`
- `SKYBLUE = [0, 255, 255]`
- `PURPLE = [139, 0, 255]`
- `WHITE = [255, 255, 255]`

**Пример:**
```python
from kamibotpi import LedColor
kb.turn_led(*LedColor.RED)
kb.turn_led(*LedColor.BLUE)
```

### Другие константы

#### Типы команд
- `COMMANDTYPE_WRITE = 0x01` - команда записи
- `COMMANDTYPE_READ = 0x02` - команда чтения
- `COMMANDTYPE_RETURN = 0x03` - команда возврата

#### Типы аппаратного обеспечения
- `HWTYPE_BOTPI = 0x00` - аппаратное обеспечение KamibotPi
- `HWTYPE_XBLOCK = 0x10` - аппаратное обеспечение XBlock

#### Настройки по умолчанию
- `DEFAULT_MOTOR_SPEED = 0x96` (150) - скорость мотора по умолчанию

---

## Примеры использования

### Базовое использование
```python
from kamibotpi import KamibotPi

# Подключение и инициализация
kb = KamibotPi(port="COM5", verbose=False)
kb.init()

try:
    # Базовое движение
    kb.move_forward(2, opt="-l")
    kb.turn_right()
    
    # Управление светодиодами
    kb.turn_led_idx(1)  # Красный
    
    # Чтение датчиков
    battery = kb.get_battery()
    print(f"Батарея: {battery}")
    
finally:
    kb.close()
```

### Управление на основе датчиков
```python
from kamibotpi import KamibotPi

kb = KamibotPi(port="COM5")
kb.init()

try:
    while True:
        # Обнаружение объектов
        left_obj, right_obj = kb.get_object_detect(True)
        
        if left_obj > 50 or right_obj > 50:
            # Обнаружено препятствие
            kb.stop()
            kb.turn_led_idx(1)  # Красный
            kb.beep()
            
            # Действие обхода
            kb.move_backward_unit(5, opt="-l")
            kb.turn_right()
        else:
            # Движение вперед
            kb.turn_led_idx(4)  # Зеленый
            kb.move_forward_unit(10, opt="-l")
            
        kb.delay(0.1)
        
except KeyboardInterrupt:
    print("Программа прервана")
finally:
    kb.close()
```

### Пример точного управления
```python
from kamibotpi import KamibotPi

kb = KamibotPi(port="COM5")
kb.init()

try:
    # Точное движение на основе шагов
    kb.move_step("f", 400, "f", 400)  # 400 шагов вперед для обоих колес
    kb.delay(1)
    
    # Точное движение на основе времени
    kb.move_time("f", 2, "b", 2)  # Левое колесо 2 сек вперед, правое 2 сек назад
    kb.delay(1)
    
    # Точное движение на основе единиц
    kb.move_forward_unit(20, opt="-l", speed=80)  # 20 см вперед
    kb.turn_left_speed(90, speed=60)              # Поворот влево на 90 градусов
    
finally:
    kb.close()
```

### Пример рисования фигур
```python
from kamibotpi import KamibotPi

kb = KamibotPi(port="COM5")
kb.init()

try:
    # Основные фигуры
    kb.draw_tri(10)      # Треугольник
    kb.delay(2)
    
    kb.draw_rect(12)     # Прямоугольник
    kb.delay(2)
    
    kb.draw_circle(8)    # Круг
    kb.delay(2)
    
    kb.draw_star(10)     # Звезда
    kb.delay(2)
    
    # Рисование полукруга
    kb.draw_semicircle(6, side="l")  # Левый полукруг
    kb.delay(2)
    
    # Рисование дуги
    kb.draw_arc(8, value=2, mode=0)  # Дуга в течение 2 секунд
    
finally:
    kb.close()
```

### Пример воспроизведения мелодии
```python
from kamibotpi import KamibotPi

kb = KamibotPi(port="COM5")
kb.init()

try:
    # Исполнение до-ре-ми
    scales = [60, 62, 64, 65, 67, 69, 71, 72]
    
    for scale in scales:
        kb.melody(scale=scale, sec=1)
        kb.delay(0.1)  # Интервал между нотами
    
    # Простая мелодия
    melody = [
        (60, 0.5), (64, 0.5), (67, 0.5), (72, 1.0),
        (67, 0.5), (64, 0.5), (60, 1.0)
    ]
    
    for scale, duration in melody:
        kb.melody(scale=scale, sec=duration)
        kb.delay(0.1)
    
    # Звуковые эффекты
    kb.beep()  # Звуковой сигнал
    
finally:
    kb.close()
```

### Пример управления верхним мотором
```python
from kamibotpi import KamibotPi

kb = KamibotPi(port="COM5")
kb.init()

try:
    # Поворот на относительный угол
    kb.top_motor_degree("r", value=90, speed=60)   # Поворот вправо на 90 градусов
    kb.delay(2)
    
    kb.top_motor_degree("l", value=180, speed=60)  # Поворот влево на 180 градусов
    kb.delay(2)
    
    # Перемещение в абсолютную позицию
    kb.top_motor_abspos(0, speed=50)  # Возврат в исходную позицию
    kb.delay(2)
    
    # Поворот на основе времени
    kb.top_motor_time("r", value=3, speed=80)  # Поворот вправо в течение 3 секунд
    kb.delay(3)
    
    # Поворот на основе количества оборотов
    kb.top_motor_round("l", value=2, speed=40)  # 2 оборота влево
    kb.delay(5)
    
    # Остановка
    kb.top_motor_stop()
    
finally:
    kb.close()
```

---

## Обработка ошибок

### Общая обработка исключений
```python
from kamibotpi import KamibotPi
import serial

try:
    kb = KamibotPi(port="COM5", baud=57600, timeout=2)
    kb.init()
    
    # Код управления роботом
    kb.move_forward(2)
    
except ValueError as e:
    print(f"Ошибка настройки порта: {e}")
except serial.SerialException as e:
    print(f"Ошибка последовательной связи: {e}")
except KeyboardInterrupt:
    print("Пользователь прервал программу.")
except Exception as e:
    print(f"Неожиданная ошибка: {e}")
finally:
    if 'kb' in locals():
        kb.close()
```

### Проверка значений датчиков
```python
def safe_sensor_read(kb):
    """Функция безопасного чтения датчиков"""
    try:
        left_obj, right_obj = kb.get_object_detect(True)
        
        # Проверка действительности значений датчиков
        if left_obj is None or right_obj is None:
            print("Невозможно прочитать значения датчиков.")
            return None, None
            
        # Проверка диапазона значений (предполагаемый диапазон 0-255)
        if not (0 <= left_obj <= 255) or not (0 <= right_obj <= 255):
            print("Значения датчиков вне допустимого диапазона.")
            return None, None
            
        return left_obj, right_obj
        
    except Exception as e:
        print(f"Ошибка чтения датчиков: {e}")
        return None, None

# Пример использования
kb = KamibotPi(port="COM5")
kb.init()

left_obj, right_obj = safe_sensor_read(kb)
if left_obj is not None and right_obj is not None:
    print(f"Обнаружение объектов: Левый={left_obj}, Правый={right_obj}")
else:
    print("Сбой чтения датчиков")
```

---

## Советы по оптимизации производительности

### 1. Использование подходящих задержек
```python
# Подходящая задержка между командами
kb.move_forward(1)
kb.delay(0.1)  # Обеспечение времени обработки команды
kb.turn_left()
```

### 2. Регулировка частоты опроса датчиков
```python
# Предотвращение слишком быстрого опроса
while True:
    sensor_data = kb.get_line_sensor(True)
    # Логика обработки
    kb.delay(0.05)  # Поддержание подходящего интервала
```

### 3. Мониторинг батареи
```python
def monitor_battery(kb, threshold=20):
    """Функция мониторинга батареи"""
    battery = kb.get_battery()
    if battery < threshold:
        kb.turn_led_idx(1)  # Красное предупреждение
        kb.beep()
        print(f"Низкий заряд батареи: {battery}")
        return False
    return True

# Периодическая проверка батареи
if not monitor_battery(kb):
    print("Завершение программы из-за низкого заряда батареи.")
    kb.close()
```

---

## Инструменты отладки

### Использование режима Verbose
```python
# Активация режима verbose для отладки
kb = KamibotPi(port="COM5", verbose=True)

# Функция отладки для мониторинга значений датчиков в реальном времени
def debug_sensors(kb, duration=10):
    """Функция отладки датчиков"""
    start_time = time.time()
    
    while time.time() - start_time < duration:
        # Чтение всех значений датчиков
        left_obj, right_obj = kb.get_object_detect(True)
        left_line, center_line, right_line = kb.get_line_sensor(True)
        color = kb.get_color_sensor(True)
        battery = kb.get_battery()
        
        # Форматированный вывод
        print(f"Время: {time.time() - start_time:.1f}с")
        print(f"Объекты: Л={left_obj:3d}, П={right_obj:3d}")
        print(f"Линия: Л={left_line:3d}, Ц={center_line:3d}, П={right_line:3d}")
        print(f"Цвет: {color:3d}, Батарея: {battery:3d}")
        print("-" * 40)
        
        kb.delay(0.5)

# Пример использования
debug_sensors(kb, duration=30)  # Мониторинг датчиков в течение 30 секунд
```

Этот справочник API предоставляет полное описание всех публичных методов и констант библиотеки KamibotPi. Каждая функция включает подробное описание параметров, возвращаемых значений и практические примеры использования, чтобы разработчики могли легко использовать библиотеку.
